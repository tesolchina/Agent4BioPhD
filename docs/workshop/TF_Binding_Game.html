<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß¨ TF Detective: The Motif Matching Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .level-indicator {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .level-indicator span {
            font-weight: bold;
            color: #667eea;
        }

        .score {
            font-size: 1.5em;
            color: #764ba2;
        }

        .story-box {
            background: #fff9e6;
            border-left: 5px solid #ffd700;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .story-box h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .dna-sequence {
            font-family: 'Courier New', monospace;
            font-size: 1.5em;
            letter-spacing: 5px;
            text-align: center;
            padding: 20px;
            background: #f8f8f8;
            border: 3px solid #667eea;
            border-radius: 10px;
            margin: 20px 0;
            user-select: none;
        }

        .base {
            display: inline-block;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .base:hover {
            transform: scale(1.2);
        }

        .base-A { background: #ff6b6b; color: white; }
        .base-T { background: #4ecdc4; color: white; }
        .base-G { background: #ffe66d; color: #333; }
        .base-C { background: #95e1d3; color: #333; }

        .base.selected {
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.8);
            transform: scale(1.3);
        }

        .motif-library {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .motif-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .motif-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .motif-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .motif-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .motif-pattern {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            letter-spacing: 3px;
            text-align: center;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 5px;
            margin: 10px 0;
        }

        .tf-info {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #95e1d3;
            color: #333;
        }

        .btn-secondary:hover {
            background: #7dd3c0;
        }

        .feedback {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.1em;
            text-align: center;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            display: block;
        }

        .feedback.incorrect {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            display: block;
        }

        .hint-box {
            background: #e7f3ff;
            border-left: 5px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .concept-box {
            background: #fff;
            border: 3px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .concept-box h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            text-align: center;
        }

        .modal h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .stars {
            font-size: 3em;
            margin: 20px 0;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .pulse {
            animation: pulse 0.5s;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #667eea;
            font-weight: bold;
        }

        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px;
            border-radius: 5px;
            white-space: nowrap;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üß¨ TF Detective: The Motif Matching Game</h1>
            <p>Learn how transcription factors find their DNA binding sites!</p>
        </div>

        <div class="level-indicator">
            <span>Level: <span id="level">1</span> - <span id="levelName">DNA Basics</span></span>
            <span class="score">Score: <span id="score">0</span></span>
            <span>Lives: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%">0%</div>
        </div>

        <div id="gameContent">
            <!-- Content will be dynamically generated -->
        </div>

        <div class="feedback" id="feedback"></div>

        <div class="buttons">
            <button class="btn-primary" id="checkBtn" onclick="checkAnswer()">Check Answer</button>
            <button class="btn-secondary" id="hintBtn" onclick="showHint()">üí° Get Hint</button>
            <button class="btn-secondary" id="nextBtn" onclick="nextLevel()" style="display:none;">Next Level ‚Üí</button>
        </div>
    </div>

    <div class="modal" id="levelCompleteModal">
        <div class="modal-content">
            <div class="stars" id="modalStars"></div>
            <h2 id="modalTitle"></h2>
            <p id="modalMessage"></p>
            <button class="btn-primary" onclick="closeModal()">Continue</button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            level: 1,
            score: 0,
            lives: 3,
            selectedMotif: null,
            selectedBases: [],
            hintsUsed: 0,
            currentChallenge: null
        };

        // Level Definitions
        const levels = [
            {
                level: 1,
                name: "DNA Basics",
                story: "Welcome, TF Detective! Your mission: help transcription factors (TFs) find their binding sites on DNA. First, let's learn about DNA!",
                type: "education",
                content: `
                    <div class="concept-box">
                        <h3>üß¨ What is DNA?</h3>
                        <p><strong>DNA</strong> is like a instruction manual for life! It's made of four building blocks called <span class="tooltip" data-tip="The four letters of the DNA alphabet">bases</span>:</p>
                        <ul style="list-style: none; padding: 20px; font-size: 1.2em;">
                            <li><span class="base base-A">A</span> Adenine (pairs with T)</li>
                            <li><span class="base base-T">T</span> Thymine (pairs with A)</li>
                            <li><span class="base base-G">G</span> Guanine (pairs with C)</li>
                            <li><span class="base base-C">C</span> Cytosine (pairs with G)</li>
                        </ul>
                        <p>These bases form a long chain, like letters in a book. But instead of words, they spell out instructions for making proteins!</p>
                    </div>
                    <div class="hint-box">
                        <strong>üéØ Your Task:</strong> Click the button below when you're ready to meet your first transcription factor!
                    </div>
                `,
                checkAnswer: () => true
            },
            {
                level: 2,
                name: "Meet the TF",
                story: "Transcription Factors (TFs) are special proteins that turn genes ON or OFF. They do this by binding to specific DNA sequences!",
                type: "education",
                content: `
                    <div class="concept-box">
                        <h3>üî¨ What is a Transcription Factor?</h3>
                        <p>Imagine a <strong>transcription factor (TF)</strong> as a molecular key üîë</p>
                        <ul style="padding: 20px; line-height: 2em;">
                            <li>üîë Each TF has a special shape that fits specific DNA sequences</li>
                            <li>üéØ When a TF finds its matching sequence, it binds to the DNA</li>
                            <li>üì£ This binding tells the cell: "Hey! Turn this gene ON (or OFF)!"</li>
                            <li>üß¨ Different TFs recognize different DNA patterns called <strong>motifs</strong></li>
                        </ul>
                        <p><strong>Example:</strong> The TF called "SOX2" likes to bind to the pattern: <span style="font-family: monospace; background: #f0f0f0; padding: 5px;">CATTGT</span></p>
                    </div>
                    <div class="hint-box">
                        <strong>üí° Think of it like:</strong> TFs are like search tools (like Ctrl+F) looking for specific words in a giant book of DNA!
                    </div>
                `,
                checkAnswer: () => true
            },
            {
                level: 3,
                name: "First Match",
                story: "Let's help SOX2 find its binding site! SOX2 is important for stem cells.",
                type: "matching",
                dna: "ACGTACATTGTCGTAGCATG",
                motifs: [
                    { name: "SOX2", pattern: "CATTGT", info: "Stem cell factor", correct: true },
                    { name: "MYC", pattern: "CACGTG", info: "Growth factor", correct: false },
                ],
                hint: "SOX2 likes the pattern CATTGT. Can you find it in the DNA sequence above?",
                explanation: "Great! SOX2 found its binding site at position 5-10 (CATTGT). When SOX2 binds here, it can turn on genes that keep cells as stem cells!"
            },
            {
                level: 4,
                name: "Multiple Motifs",
                story: "Real DNA has many possible binding sites. Let's find the right ones!",
                type: "matching",
                dna: "TGACGTCACATTGTGACGTCAGCAT",
                motifs: [
                    { name: "SOX2", pattern: "CATTGT", info: "Stem cell regulator", correct: true },
                    { name: "AP1", pattern: "TGACGTCA", info: "Stress response", correct: true },
                    { name: "NRF1", pattern: "GCGCA", info: "Metabolism", correct: false },
                ],
                hint: "Look for both TGACGTCA (at the start) and CATTGT (in the middle). There are TWO correct motifs!",
                explanation: "Excellent! Both AP1 and SOX2 can bind to this DNA. This is called 'combinatorial regulation' - multiple TFs working together!"
            },
            {
                level: 5,
                name: "Understanding P-values",
                story: "Not all matches are perfect! motifmatchr uses p-values to decide if a match is 'good enough'.",
                type: "education",
                content: `
                    <div class="concept-box">
                        <h3>üìä What is a P-value in Motif Matching?</h3>
                        <p>Sometimes DNA sequences look <em>almost</em> like a motif, but not exactly. How do we decide if it's a real match?</p>
                        <div style="background: #f8f8f8; padding: 20px; margin: 20px 0; border-radius: 10px;">
                            <p><strong>P-value</strong> = "How likely is this match just random chance?"</p>
                            <ul style="padding: 20px; line-height: 2em;">
                                <li>‚úÖ <strong>Low p-value (like 0.00001)</strong> = "This is probably a REAL binding site!"</li>
                                <li>‚ùå <strong>High p-value (like 0.1)</strong> = "This might just be random..."</li>
                                <li>üéØ <strong>Default threshold: 0.00005</strong> = motifmatchr's standard cutoff</li>
                            </ul>
                        </div>
                        <p><strong>Example:</strong></p>
                        <ul style="padding: 20px;">
                            <li>Perfect match "CATTGT" ‚Üí p-value = 0.0001 ‚úÖ KEEP IT!</li>
                            <li>Close match "CACTGT" ‚Üí p-value = 0.002 ‚úÖ Pretty good!</li>
                            <li>Weak match "CAGGGT" ‚Üí p-value = 0.08 ‚ùå Probably not real</li>
                        </ul>
                    </div>
                    <div class="hint-box">
                        <strong>üéì Why this matters:</strong> Too strict (low p-value) = miss real sites. Too loose (high p-value) = find lots of fake sites!
                    </div>
                `,
                checkAnswer: () => true
            },
            {
                level: 6,
                name: "AT-rich vs GC-rich",
                story: "Different regions of DNA have different compositions. This affects what we find!",
                type: "education",
                content: `
                    <div class="concept-box">
                        <h3>üå°Ô∏è Background Frequencies Matter!</h3>
                        <p>DNA isn't 25% each base everywhere. Different regions have different compositions:</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                            <div style="background: #ffe6e6; padding: 20px; border-radius: 10px;">
                                <h4>AT-rich regions</h4>
                                <p style="font-family: monospace; font-size: 1.3em;">AAAATTTTAAAT</p>
                                <p>~60% A+T<br>Common in intergenic regions</p>
                            </div>
                            <div style="background: #e6f7ff; padding: 20px; border-radius: 10px;">
                                <h4>GC-rich regions</h4>
                                <p style="font-family: monospace; font-size: 1.3em;">GCGCGCGGCCGC</p>
                                <p>~60% G+C<br>Common in gene promoters</p>
                            </div>
                        </div>
                        <p><strong>Why does motifmatchr care?</strong></p>
                        <ul style="padding: 20px; line-height: 2em;">
                            <li>üé≤ Finding "AAAA" in AT-rich DNA? Not impressive - it's common!</li>
                            <li>‚ú® Finding "AAAA" in GC-rich DNA? That's unusual - might be important!</li>
                            <li>‚öôÔ∏è motifmatchr adjusts scores based on background frequencies</li>
                        </ul>
                    </div>
                    <div class="hint-box">
                        <strong>üîß In motifmatchr:</strong> You can set <code>bg = "genome"</code> to use actual genome composition, or <code>bg = "even"</code> to assume 25% each!
                    </div>
                `,
                checkAnswer: () => true
            },
            {
                level: 7,
                name: "Real Research Scenario",
                story: "You're analyzing ATAC-seq peaks (open DNA regions) from neurons. Find the right TFs!",
                type: "matching",
                dna: "TGACGTCAGCATTGTCCGCTGACGTCATCG",
                motifs: [
                    { name: "SOX2", pattern: "CATTGT", info: "Also active in neural progenitors", correct: true },
                    { name: "AP1", pattern: "TGACGTCA", info: "Stress response (not neuron-specific)", correct: false },
                    { name: "NEUROD1", pattern: "CATCTG", info: "Neuron differentiation master regulator", correct: false },
                ],
                hint: "In ATAC-seq, we look for open chromatin. NEUROD1 isn't in this sequence, but SOX2 is! AP1 is there but not neuron-specific.",
                explanation: "Good thinking! In real research, we'd check if TFs are expressed (RNA-seq) AND if their motifs are in open regions (ATAC-seq). SOX2 in neurons makes sense!"
            },
            {
                level: 8,
                name: "The MOODS Algorithm",
                story: "How does motifmatchr search so fast? It uses a clever algorithm called MOODS!",
                type: "education",
                content: `
                    <div class="concept-box">
                        <h3>‚ö° How motifmatchr is FAST</h3>
                        <p>Imagine you have:</p>
                        <ul style="padding: 20px; line-height: 2em;">
                            <li>üß¨ 10,000 DNA regions (peaks from ATAC-seq)</li>
                            <li>üîç 500 TF motifs to search for</li>
                            <li>üìè Each region is ~500 bases long</li>
                        </ul>
                        <p><strong>Naive approach:</strong> Check every motif in every position = 10,000 √ó 500 √ó 500 = 2.5 BILLION comparisons! üò±</p>
                        
                        <div style="background: #e8f5e9; padding: 20px; margin: 20px 0; border-radius: 10px;">
                            <h4>üöÄ MOODS Solution (Aho-Corasick Algorithm):</h4>
                            <p>Instead of checking each motif separately, MOODS:</p>
                            <ol style="padding: 20px; line-height: 2em;">
                                <li>Builds a "search tree" of ALL motifs at once</li>
                                <li>Scans DNA just ONCE, checking all motifs simultaneously</li>
                                <li>Uses clever shortcuts to skip impossible matches</li>
                            </ol>
                            <p><strong>Result:</strong> 100x faster! Can scan your 10,000 peaks in seconds instead of hours! ‚ö°</p>
                        </div>

                        <p><strong>This is why researchers love motifmatchr:</strong></p>
                        <ul style="padding: 20px;">
                            <li>‚úÖ Fast enough for single-cell data (millions of tests)</li>
                            <li>‚úÖ Can test hundreds of TFs at once</li>
                            <li>‚úÖ Written in C++ for extra speed</li>
                            <li>‚úÖ Easy to use from R</li>
                        </ul>
                    </div>
                `,
                checkAnswer: () => true
            },
            {
                level: 9,
                name: "GRN Inference",
                story: "The ultimate goal: building Gene Regulatory Networks (GRNs)!",
                type: "education",
                content: `
                    <div class="concept-box">
                        <h3>üï∏Ô∏è From Motifs to Gene Regulatory Networks</h3>
                        <p>Now you understand motif matching! But what's it FOR?</p>
                        
                        <div style="background: #fff9e6; padding: 20px; margin: 20px 0; border-radius: 10px; border-left: 5px solid #ffd700;">
                            <h4>The Big Picture:</h4>
                            <p style="font-size: 1.1em; line-height: 2em;">
                                1Ô∏è‚É£ ATAC-seq tells us: <em>"These DNA regions are open"</em><br>
                                2Ô∏è‚É£ motifmatchr tells us: <em>"TF X can bind here"</em><br>
                                3Ô∏è‚É£ Link peak to gene: <em>"This peak controls gene Y"</em><br>
                                4Ô∏è‚É£ RNA-seq confirms: <em>"Gene Y is actually expressed"</em><br>
                                <strong>= üéØ TF X probably regulates gene Y!</strong>
                            </p>
                        </div>

                        <p><strong>Real Research Example:</strong></p>
                        <div style="background: #f0f4ff; padding: 20px; margin: 20px 0; border-radius: 10px;">
                            <p><em>"I'm studying how cells become neurons..."</em></p>
                            <ol style="padding: 20px; line-height: 2em;">
                                <li>üß´ Collect cells at different stages (iPSC ‚Üí neuron)</li>
                                <li>üî¨ Run scATAC-seq + scRNA-seq</li>
                                <li>üîç Use motifmatchr to find TF motifs in stage-specific peaks</li>
                                <li>üìä Build GRN: which TFs control which genes</li>
                                <li>üí° Discover: "NEUROD1 activates 50 neuron genes!"</li>
                                <li>üß™ Test in lab: knock out NEUROD1 ‚Üí no neurons!</li>
                            </ol>
                        </div>

                        <p><strong>This is what makes motifmatchr powerful:</strong> It's one piece of a bigger puzzle to understand how cells work!</p>
                    </div>
                `,
                checkAnswer: () => true
            },
            {
                level: 10,
                name: "Final Challenge",
                story: "You've learned everything! Now prove you're a master TF Detective!",
                type: "matching",
                dna: "GCATTGTTGACGTCAGGCCGCATTGTAAATCATTGTCGC",
                motifs: [
                    { name: "SOX2", pattern: "CATTGT", info: "Found 3 times!", correct: true },
                    { name: "AP1", pattern: "TGACGTCA", info: "Important stress response", correct: true },
                    { name: "OCT4", pattern: "ATGCAAAT", info: "Pluripotency factor", correct: true },
                    { name: "NANOG", pattern: "CGCCG", info: "Also pluripotency", correct: false },
                ],
                hint: "Look carefully! SOX2 appears THREE times, AP1 once, and OCT4 once (ATGCAAAT ‚Üí AAAT is part of pattern). NANOG isn't here.",
                explanation: "üéâ Amazing! You found all the TFs! Notice SOX2 appears 3 times - this is called 'motif density' and often means this region is VERY important for regulation!"
            }
        ];

        // Initialize game
        function initGame() {
            loadLevel(gameState.level);
        }

        function loadLevel(levelNum) {
            const level = levels[levelNum - 1];
            gameState.currentChallenge = level;
            gameState.selectedMotif = null;
            gameState.selectedBases = [];
            
            document.getElementById('level').textContent = level.level;
            document.getElementById('levelName').textContent = level.name;
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            
            updateProgress();

            const gameContent = document.getElementById('gameContent');
            
            if (level.type === 'education') {
                gameContent.innerHTML = `
                    <div class="story-box">
                        <h3>üìñ ${level.name}</h3>
                        <p>${level.story}</p>
                    </div>
                    ${level.content}
                `;
                document.getElementById('checkBtn').textContent = 'I Understand! ‚Üí';
                document.getElementById('hintBtn').style.display = 'none';
            } else if (level.type === 'matching') {
                gameContent.innerHTML = `
                    <div class="story-box">
                        <h3>üéØ Mission:</h3>
                        <p>${level.story}</p>
                    </div>
                    <h3 style="margin: 20px 0;">DNA Sequence:</h3>
                    <div class="dna-sequence" id="dnaDisplay"></div>
                    <h3 style="margin: 20px 0;">TF Motif Library (Click to select):</h3>
                    <div class="motif-library" id="motifLibrary"></div>
                    <div class="hint-box" style="display: none;" id="hintDisplay"></div>
                `;
                
                renderDNA(level.dna);
                renderMotifs(level.motifs);
                document.getElementById('checkBtn').textContent = 'Check My Answer';
                document.getElementById('hintBtn').style.display = 'block';
            }
        }

        function renderDNA(sequence) {
            const dnaDisplay = document.getElementById('dnaDisplay');
            dnaDisplay.innerHTML = sequence.split('').map((base, index) => 
                `<span class="base base-${base}" data-index="${index}">${base}</span>`
            ).join('');
        }

        function renderMotifs(motifs) {
            const library = document.getElementById('motifLibrary');
            library.innerHTML = motifs.map((motif, index) => `
                <div class="motif-card" data-motif="${index}" onclick="selectMotif(${index})">
                    <h4>${motif.name}</h4>
                    <div class="motif-pattern">${motif.pattern}</div>
                    <div class="tf-info">${motif.info}</div>
                </div>
            `).join('');
        }

        function selectMotif(index) {
            const level = gameState.currentChallenge;
            const cards = document.querySelectorAll('.motif-card');
            const card = cards[index];
            
            if (card.classList.contains('selected')) {
                card.classList.remove('selected');
                const motifIndex = gameState.selectedMotif.indexOf(index);
                if (motifIndex > -1) {
                    gameState.selectedMotif.splice(motifIndex, 1);
                }
            } else {
                card.classList.add('selected');
                if (!gameState.selectedMotif) gameState.selectedMotif = [];
                gameState.selectedMotif.push(index);
            }
        }

        function checkAnswer() {
            const level = gameState.currentChallenge;
            const feedback = document.getElementById('feedback');
            
            if (level.type === 'education') {
                // Educational levels always "pass"
                feedback.className = 'feedback correct';
                feedback.innerHTML = '‚úÖ Great! Ready for the next challenge?';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('checkBtn').style.display = 'none';
                return;
            }
            
            if (!gameState.selectedMotif || gameState.selectedMotif.length === 0) {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '‚ùå Please select at least one TF motif first!';
                return;
            }
            
            // Check if answer is correct
            const correctMotifs = level.motifs.map((m, i) => m.correct ? i : -1).filter(i => i >= 0);
            const selected = gameState.selectedMotif.sort();
            const isCorrect = JSON.stringify(selected.sort()) === JSON.stringify(correctMotifs.sort());
            
            if (isCorrect) {
                gameState.score += 100;
                document.getElementById('score').textContent = gameState.score;
                feedback.className = 'feedback correct';
                feedback.innerHTML = `
                    <div class="pulse">
                        üéâ Excellent work, Detective! üéâ<br>
                        ${level.explanation}
                    </div>
                `;
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('hintBtn').style.display = 'none';
            } else {
                gameState.lives--;
                updateLives();
                feedback.className = 'feedback incorrect';
                
                if (gameState.lives > 0) {
                    feedback.innerHTML = `‚ùå Not quite! Try again. ${level.hint ? 'Click the hint button if you need help!' : ''}`;
                } else {
                    feedback.innerHTML = `üíî Out of lives! But don't worry - you've learned a lot! The correct answer was: ${correctMotifs.map(i => level.motifs[i].name).join(', ')}`;
                    document.getElementById('nextBtn').style.display = 'inline-block';
                    document.getElementById('checkBtn').style.display = 'none';
                }
            }
        }

        function showHint() {
            const level = gameState.currentChallenge;
            if (level.hint) {
                const hintDisplay = document.getElementById('hintDisplay');
                hintDisplay.style.display = 'block';
                hintDisplay.innerHTML = `<strong>üí° Hint:</strong> ${level.hint}`;
                gameState.hintsUsed++;
            }
        }

        function nextLevel() {
            gameState.level++;
            
            if (gameState.level > levels.length) {
                showCompletionModal();
            } else {
                if (gameState.lives === 0) gameState.lives = 3;
                updateLives();
                loadLevel(gameState.level);
            }
        }

        function updateLives() {
            const hearts = '‚ù§Ô∏è'.repeat(gameState.lives) + 'üñ§'.repeat(3 - gameState.lives);
            document.getElementById('lives').textContent = hearts;
        }

        function updateProgress() {
            const progress = (gameState.level / levels.length) * 100;
            const progressBar = document.getElementById('progress');
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }

        function showCompletionModal() {
            const modal = document.getElementById('levelCompleteModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalStars = document.getElementById('modalStars');
            
            modalStars.textContent = 'üåüüåüüåü';
            modalTitle.textContent = 'Congratulations, Master Detective!';
            modalMessage.innerHTML = `
                <p style="font-size: 1.2em; margin: 20px 0;">You've completed all levels!</p>
                <p><strong>Final Score: ${gameState.score}</strong></p>
                <p><strong>Hints Used: ${gameState.hintsUsed}</strong></p>
                <br>
                <div style="text-align: left; padding: 20px; background: #f0f4ff; border-radius: 10px;">
                    <h3>üéì What You've Learned:</h3>
                    <ul style="line-height: 2em;">
                        <li>‚úÖ DNA structure and bases (A, T, G, C)</li>
                        <li>‚úÖ How transcription factors work</li>
                        <li>‚úÖ Motif matching concepts</li>
                        <li>‚úÖ P-values and statistical significance</li>
                        <li>‚úÖ Background frequencies (AT-rich vs GC-rich)</li>
                        <li>‚úÖ The MOODS algorithm</li>
                        <li>‚úÖ Gene regulatory networks (GRNs)</li>
                    </ul>
                </div>
                <br>
                <p><strong>üöÄ Ready for Real Research?</strong></p>
                <p>Try using motifmatchr in R with real ATAC-seq data!</p>
            `;
            
            modal.classList.add('show');
        }

        function closeModal() {
            const modal = document.getElementById('levelCompleteModal');
            modal.classList.remove('show');
            
            // Reset game or return to start
            gameState = {
                level: 1,
                score: 0,
                lives: 3,
                selectedMotif: null,
                selectedBases: [],
                hintsUsed: 0,
                currentChallenge: null
            };
            updateLives();
            initGame();
        }

        // Start the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>